<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="employeeMapper">
	<select id="findAll"
			resultType="employee">
	SELECT
           EMP_ID empId
         , EMP_NAME empName
         , SALARY salary
    	 , DEPT_TITLE deptTitle
    	 , JOB_NAME jobName
	  FROM 
      	   EMPLOYEE
	  JOIN
           DEPARTMENT ON (DEPT_ID = DEPT_CODE)
	  JOIN
      	   JOB USING (JOB_CODE)		
	</select>
	
	<select id="findByDept"
	        parameterType="string"
	        resultType="employee">
		SELECT
	           EMP_ID empId
	         , EMP_NAME empName
	         , SALARY salary
	         , DEPT_TITLE deptTitle
	     	 , JOB_NAME jobName
		  FROM 
	       	   EMPLOYEE
		  JOIN
	       	   DEPARTMENT ON (DEPT_ID = DEPT_CODE)
	 	  JOIN
	       	   JOB USING (JOB_CODE)
		 WHERE
	       	   DEPT_TITLE = #{deptTitle}
	</select>
	
	<select id="findByJob"
	        parameterType="string"
	        resultType="employee">
		SELECT
	       	   EMP_ID empId
	     	 , EMP_NAME empName
	     	 , SALARY salary
	     	 , DEPT_TITLE deptTitle
	     	 , JOB_NAME jobName
	 	  FROM 
	       	   EMPLOYEE
	 	  JOIN
	       	   DEPARTMENT ON (DEPT_ID = DEPT_CODE)
	 	  JOIN
	       	   JOB USING (JOB_CODE)
		 WHERE
	      	   JOB_NAME = #{jobName}        
	</select>
	
	<select id="findByEmployee"
			parameterType="string"
			resultType="employeeDto">
		SELECT
	           EMP_ID empId
	         , EMP_NAME empName
	         , EMP_NO empNo
	         , EMAIL email
	         , PHONE phone
	         , DEPT_TITLE deptTitle
	         , JOB_NAME jobName
	         , SAL_LEVEL salLevel
	         , SALARY salary
	         , BONUS bonus
	         , MANAGER_ID managerId
	         , HIRE_DATE hireDate
	         , ENT_YN entYn
		  FROM 
	           EMPLOYEE
	      JOIN
	           DEPARTMENT ON (DEPT_ID = DEPT_CODE)
	      JOIN
	           JOB USING (JOB_CODE)
	     WHERE
	           EMP_ID = #{empId}
	
	</select>
	
	<select id="findTop5Salaries"
			resultType="employee">
		SELECT
	             EMP_ID empId
	           , EMP_NAME empName
	       	   , SALARY 
	       	   , DEPT_TITLE deptTitle
		       , JOB_NAME jobName
		    FROM
		         (SELECT 
		                 EMP_ID
		               , EMP_NAME
		               , SALARY
		               , DEPT_TITLE
		               , JOB_NAME
		            FROM 
		                 EMPLOYEE
		            JOIN
		                 JOB USING(JOB_CODE)
		            JOIN
		                 DEPARTMENT ON (DEPT_ID = DEPT_CODE)
		           ORDER
		              BY
		                 SALARY DESC)
		    WHERE
		          ROWNUM &lt;= 5
	</select>
	
	<select id="findBottom5Salaries"
			resultType="employee">
		  SELECT
	             EMP_ID empId
	           , EMP_NAME empName
	       	   , SALARY salary
	       	   , DEPT_TITLE deptTitle
		       , JOB_NAME jobName
		    FROM
		         (SELECT 
		                 EMP_ID
		               , EMP_NAME
		               , SALARY
		               , DEPT_TITLE
		               , JOB_NAME
		            FROM 
		                 EMPLOYEE
		            JOIN
		                 JOB USING(JOB_CODE)
		            JOIN
		                 DEPARTMENT ON (DEPT_ID = DEPT_CODE)
		           ORDER
		              BY
		                 SALARY ASC)
		    WHERE
		          ROWNUM &lt;= 5
	</select>
	
	<insert id="insertEmployee"
	        parameterType="employeeDto">
	        INSERT
        INTO
             EMPLOYEE
      VALUES
             (
             #{empId}
           , #{empName}
           , #{empNo}
           , #{email}
           , #{phone}
           , #{deptTitle}
           , #{jobName}
           , #{salLevel}
           , #{salary}
           , #{bonus}
           , #{managerId}
           , SYSDATE
           , NULL
           , #{entYn}  
             ) 
	</insert>
	
	<select id="getJobCodeByName"
			parameterType="string"
			resultType="java.lang.String">
		SELECT 
	           JOB_CODE 
	      FROM JOB 
	     WHERE 
	           JOB_NAME = #{jobName}
	
	</select>

	<select id="getDeptCodeByTitle"
			parameterType="string"
			resultType="java.lang.String">
		SELECT 
	           DEPT_ID 
	      FROM 
	           DEPARTMENT 
	     WHERE 
	           DEPT_TITLE = #{deptTitle}
	</select>

	<update id="updateEmployee"
			parameterType="java.util.Map">
		UPDATE 
	           EMPLOYEE 
	       SET 
	           SALARY = #{salary}
	         , JOB_CODE = #{jobCode}
	         , DEPT_CODE = #{deptId}
	     WHERE 
	           EMP_ID = #{empId}
	</update>
	
	<update id="retireEmployee"
			parameterType="employeeDto">
		 UPDATE 
	             EMPLOYEE
	         SET
	             ENT_YN = #{entYn},
	             ENT_DATE = CASE WHEN #{entYn} = 'Y' THEN SYSDATE ELSE NULL END
	       WHERE
	             EMP_ID = #{empId}
	</update>
	

</mapper>